sequenceDiagram
    autonumber
    participant Client as Cliente (Postman / App)
    participant ESP32 as ESP32 HTTP Server
    participant MQTT as Broker MQTT
    participant Sub as Suscriptor (mosquitto_sub / Node-RED)

    Client->>ESP32: GET /move?dir=fwd&speed=150&duration_ms=1000
    activate ESP32
    ESP32->>ESP32: Valida params (cap a 5000 ms)
    ESP32->>ESP32: Ejecuta motores (adelante, PWM=150)
    ESP32-->>Client: 200 OK {ok:true, ... caller_ip}
    ESP32->>MQTT: publish "esp32car/commands" {"dir":"fwd",...,"caller_ip": "x.x.x.x"}
    deactivate ESP32

    MQTT-->>Sub: mensage en topic "esp32car/commands"

    Client->>ESP32: GET /health
    ESP32-->>Client: 200 OK {"status":"ok","uptime_ms":...,"mqtt_connected":true}

    Note over ESP32: Al vencer duration_ms: stopAll()
